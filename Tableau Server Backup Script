# Hi All, Hope the below mentioned steps will help you to setup the tableau Server Back up and HOuse cleaning activity
# I am using the below code to 
# 1. Take Daily Backup
# 2. Store a copy of the backup file to Network location (another Server)
# 3. Delete the Historical file (Older than 4 days) to save the space
# 4. Saveed the script named as as Server_Backup.ps1 (Powershell script) and scheduled it to run during Off-peak hours

# Note: I have installed the Backup under "C" drive, please updat the location if you saved it under different location. My backup file storage location is: C:\Tableau\Tableau Server\data\tabsvc\files\backups\

# Colelct Datetime to add in File name
$ydatestr=(Get-Date).AddDays(-1).ToString('yyyy-MM-dd')
$datestr=(Get-Date).ToString('yyyy-MM-dd')

# Mail detail
$From = "<Provide the From Mail ID>"
$To = "<Provide your Mail ID>”

$Subject = "Tableau Server Backup is Completed"
$Body = "<h2>Tableau Server Backup is completed</h2><br><br>"
# If you have a network drive, you can copy the data to that location for DR purpose
$Body += “Yesterday's data copied on to New server <Server_Name>” 

$SMTPServer = "<Provide your SMTP server Detail>"
$SMTPPort = "<Provide your SMTP Port number>"

# Run Backup script to collect data
tsm maintenance backup --file Daily_backup -d

# Update the file name
$filename="Daily_backup-$datestr.tsbak"
Write-host $filename
# Move File to new Server for backup <Server_NAme>, You can skip the below code incase you don't have a backup path available to save the data
Move-Item "C:\Tableau\Tableau Server\data\tabsvc\files\backups\$filename" -Destination "\\<Server_Path>\D$\Server_Backup\"


# Delete yesterday's Backup to free up space in your current drive. You can skip this command in case you have enought space available in your Computer drive.
$yfilename="Daily_backup-$ydatestr.tsbak"
Write-host $yfilename
Remove-item -path "C:\Tableau\Tableau Server\data\tabsvc\files\backups\$yfilename"


# I am deeting File Older than 4 Days to free up space for other Tasks
 # System Datetime
$Olddatestr=(Get-Date).AddDays(-4).ToString('yyyy-MM-dd')


# Delete Old Backup
$filename="Daily_backup-$Olddatestr.tsbak"
Write-host $filename
Remove-item -path "D:\Server_Backup\$Oldfilename" 


# Send a mail informing Server Back is completed

Send-MailMessage -From $From -to $To -Subject $Subject -Body $Body -BodyAsHtml -SmtpServer $SMTPServer -Port $SMTPPort
